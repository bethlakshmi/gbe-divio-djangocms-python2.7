{% extends 'base.tmpl' %}
{% load gbe_tags %}
{% load staticfiles sekizai_tags %}

{% block title %}
   Act Tech Report
{% endblock %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.10/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/fonts/simple-line-icons.css">
{% endblock %}
{% block content %}


  <p class="vanilla">{{title}} </p>
  <h2 class="review-title">Act Tech Info for {{this_show}}</h2>
  <br/>
      {% include "conference_picker.tmpl" %}
  <br/>


  Also view:
  {% for show in all_shows %}
    <a href="{% url 'reporting:act_techinfo_review' show.eventitem_id%}">{{show}}</a>
    {% if not forloop.last %} | {% endif %}
  {% endfor %}
  
  {% if scheduling_link and scheduling_link|length > 0 %}
    </br></br>
    <a href="{{scheduling_link}}">Schedule Acts for this Show</a>
  {% endif %}
<br><br>
<span class="error_row">Highlighted text</span> reflects incomplete acts.<br>
<span class="error_row"><b>Bold and red names</b></span> reflects acts with
deactivated users.<br>

  {% if messages %}
      <script>
    alert("{% for message in messages %}{{message.tags|capfirst}}: {{message}}\n{% endfor %}");
      </script>
  {% endif %}

  {% if acts %}
  <div>Press the arrows to sort on a column.  To sort on an additional sub-order,
  press "Shift" to sort a secondary column.</div>
  <br/>
  <div>
    Toggle column(s):
    <a class="toggle-vis" data-column="0">
	# (Order)</a> -
    <a class="toggle-vis" data-column="1">
	Act</a> -
      <a class="toggle-vis" data-column="2">
	Performer</a> -
      <a class="toggle-vis" data-column="3">
	Contact Email</a> -
      <a class="toggle-vis" data-column="4">
	Rehearsal</a> -
      <a class="toggle-vis" data-column="5">
	Music</a> -
      <a class="toggle-vis" data-column="6">
	Action</a>
  </div>
  <br/>
  <table id="bid_review" class="order-column" cellspacing="0" width="100%">
    <thead>
      <tr class="bid-table">
        <th class="bid-table" >#</th>
        <th class="bid-table" >Act</th>
        <th class="bid-table" >Performer</th>
        <th class="bid-table" >Rehearsal</th>
        <th class="bid-table" >Music</th>
        <th class="bid-table" >Action</th>
      </tr>
    </thead>
    <tfoot>
      <tr class="bid-table">
        <th class="bid-table" >#</th>
        <th class="bid-table" >Act</th>
        <th class="bid-table" >Performer</th>
        <th class="bid-table" >Rehearsal</th>
        <th class="bid-table" >Music</th>
        <th class="bid-table" >Action</th>
      </tr>
    </tfoot>
    <tbody>
    {% for act in acts %}
      <tr  {% if not act.act.tech.is_complete  %}class="error_row"{%else%} class="bid-table"{% endif %} >
          <td class="bid-table">{% if act.order %}{{ act.order }}{% endif %}
	  <td class="bid-table">{{ act.act.b_title }}</td>
	  <td class="bid-table">
	    {% if not act.act.performer.contact.user_object.is_active  %}
	      <span class="error_row" class="bid-table"><b>
	    {% endif %}
	      {{ act.act.performer }}
	    {% if not act.act.performer.contact.user_object.is_active  %}
	      - INACTIVE</b></span>
	    {% endif %}<br>
      <a href='mailto:{{act.act.performer.contact.user_object.email}}'>
            {{act.act.performer.contact.user_object.email}}</a></td>
	  <td class="bid-table">{% for rehearsal in act.rehearsals %}
            {{rehearsal.start_time}}<br>
            {%endfor%}
          </td>

	  <td class="bid-table">
            {% if act.act.tech.track %}
            <a href="{{act.act.tech.track.url}}">{{act.act.tech.track.name | display_track_title:20 }}</a>
            {% elif act.act.tech.confirm_no_music %}
            No audio track needed
            {% else %}
            <span class="error_row">No track provided</span>
            {% endif %}
          </td>
          <td class="bid-table">
  <div class="btn-group">
    <a href="{% url 'reporting:act_techinfo_detail' act.act.pk%}" class="btn btn-default btn-sm">
        <i class="fa fa-eye"></i></a>
  {% if act.act.video_link and act.act.video_choice != "1" %}
    <a href="{{ act.act.video_link }}" class="btn btn-default btn-sm"><i class="fas fa-video"></i></a>{% endif %}
	  {% if change_acts %}<a href="{% url 'gbe:act_tech_wizard' act.act.id%}" class="btn btn-default btn-sm"><i class="icon-pencil"></i></a>
    <a href="{% url 'gbe:act_tech_wizard' act.act.id%}" class="btn btn-default btn-sm">
        <i class="icon-trash"></i></a>{% endif %}</div>
	  </td>
      </tr>

    {% endfor %}
    </tbody>
  </table>
  {% else %}
    <br>
    There are no available acts.  That may mean that:
    <ul>
    <li>The show has not been scheduled - check the scheduler</li>
    <li>There are no acts in the show - check bid review for acts</li>
    <li>The show identified does not exist - please pick from the list above...</li>
    </ul>
{% endif %}
{% addtoblock "js" %}
  <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
  <script>
  $(document).ready(function() {
    var table = $('#bid_review').DataTable({
      "paging": false,
      "columnDefs": [
        { "width": "5%", "targets": 0 }
      ]
    } );
 
    $('a.toggle-vis').on( 'click', function (e) {
        e.preventDefault();
 
        // Get the column API object
        var column = table.column( $(this).attr('data-column') );
 
        // Toggle the visibility
        column.visible( ! column.visible() );
    } );
  } );
  </script>
{% endaddtoblock %}
{% endblock %}
